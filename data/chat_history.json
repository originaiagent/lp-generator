[
  {
    "role": "user",
    "content": "ä»Šã€å·¦ã®ã‚¿ãƒ–ãŒè‹±èªã ã‘ã©æ—¥æœ¬èªã«ä¿®æ­£ã—ãŸã„ã€‚",
    "images": [],
    "timestamp": "2026-01-04T11:40:17.714256"
  },
  {
    "role": "assistant",
    "content": "å·¦ã®ã‚¿ãƒ–ãŒè‹±èªã«ãªã£ã¦ã„ã‚‹å•é¡Œã‚’ä¿®æ­£ã—ã¾ã™ã€‚Streamlitã®ãƒšãƒ¼ã‚¸ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æ—¥æœ¬èªã«ã™ã‚‹ãŸã‚ã«ã€å„ãƒšãƒ¼ã‚¸ãƒ•ã‚¡ã‚¤ãƒ«å†…ã§ã‚¿ã‚¤ãƒˆãƒ«ã‚’è¨­å®šã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚\n\n===FILE: main.py===\n```python\nimport streamlit as st\n\n# ãƒšãƒ¼ã‚¸è¨­å®š\nst.set_page_config(\n    page_title=\"LPã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ãƒ¼\",\n    page_icon=\"ğŸš€\",\n    layout=\"wide\",\n    initial_sidebar_state=\"expanded\"\n)\n\n# ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„\nst.title(\"ğŸš€ LPã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ãƒ¼\")\nst.markdown(\"---\")\n\ncol1, col2, col3 = st.columns(3)\n\nwith col1:\n    st.markdown(\"\"\"\n    ### ğŸ“‹ è£½å“ç®¡ç†\n    - æ–°è¦è£½å“ä½œæˆ\n    - è£½å“ä¸€è¦§è¡¨ç¤º\n    - è£½å“é¸æŠãƒ»ç·¨é›†\n    \"\"\")\n\nwith col2:\n    st.markdown(\"\"\"\n    ### ğŸ¨ ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ç”Ÿæˆ\n    - ãƒ¢ãƒ‡ãƒ«ç”»åƒç”Ÿæˆ\n    - ãƒšãƒ¼ã‚¸æ§‹æˆè¨­è¨ˆ\n    - è©³ç´°ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ä½œæˆ\n    \"\"\")\n\nwith col3:\n    st.markdown(\"\"\"\n    ### âš™ï¸ è¨­å®šãƒ»å‡ºåŠ›\n    - AIè¨­å®šç®¡ç†\n    - ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆèª¿æ•´\n    - æœ€çµ‚å‡ºåŠ›ç”Ÿæˆ\n    \"\"\")\n\nst.markdown(\"---\")\n\n# ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆ\nst.subheader(\"ğŸš€ ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆ\")\n\nstep_col1, step_col2, step_col3, step_col4 = st.columns(4)\n\nwith step_col1:\n    if st.button(\"1ï¸âƒ£ è£½å“ä½œæˆ\", use_container_width=True):\n        st.switch_page(\"pages/01_product_list.py\")\n\nwith step_col2:\n    if st.button(\"2ï¸âƒ£ æƒ…å ±å…¥åŠ›\", use_container_width=True):\n        st.switch_page(\"pages/02_input.py\")\n\nwith step_col3:\n    if st.button(\"3ï¸âƒ£ ãƒ¢ãƒ‡ãƒ«è¨­å®š\", use_container_width=True):\n        st.switch_page(\"pages/03_model.py\")\n\nwith step_col4:\n    if st.button(\"4ï¸âƒ£ æ§‹æˆè¨­è¨ˆ\", use_container_width=True):\n        st.switch_page(\"pages/04_structure.py\")\n\n# ç¾åœ¨ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆçŠ¶æ³\nif 'current_product_id' in st.session_state:\n    st.success(f\"ç¾åœ¨é¸æŠä¸­: {st.session_state.get('current_product_name', 'ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ')}\")\nelse:\n    st.info(\"è£½å“ã‚’é¸æŠã—ã¦ãã ã•ã„\")\n\n# ãƒ•ãƒƒã‚¿ãƒ¼\nst.markdown(\"---\")\nst.caption(\"LPã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ãƒ¼ v1.0 - AIé§†å‹•ã®ãƒ©ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ãƒšãƒ¼ã‚¸ä½œæˆãƒ„ãƒ¼ãƒ«\")\n```\n\nå„ãƒšãƒ¼ã‚¸ãƒ•ã‚¡ã‚¤ãƒ«ã®å…ˆé ­ã§ä»¥ä¸‹ã®è¨­å®šã‚’è¿½åŠ ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ä¾‹ãˆã°ï¼š\n\n===FILE: pages/01_product_list.py===\n```python\nimport streamlit as st\n\n# ãƒšãƒ¼ã‚¸ã‚¿ã‚¤ãƒˆãƒ«è¨­å®šï¼ˆã‚µã‚¤ãƒ‰ãƒãƒ¼è¡¨ç¤ºç”¨ï¼‰\nst.set_page_config(page_title=\"ğŸ“‹ è£½å“ä¸€è¦§\")\n\nst.title(\"ğŸ“‹ è£½å“ä¸€è¦§\")\n\n# ä»¥ä¸‹ã€æ—¢å­˜ã®ã‚³ãƒ¼ãƒ‰\n```\n\nåŒæ§˜ã«ä»–ã®ãƒšãƒ¼ã‚¸ãƒ•ã‚¡ã‚¤ãƒ«ã§ã‚‚ã€å„ãƒ•ã‚¡ã‚¤ãƒ«ã®å…ˆé ­ã§ã‚¿ã‚¤ãƒˆãƒ«ã‚’æ—¥æœ¬èªã§è¨­å®šã—ã¦ãã ã•ã„ï¼š\n\n- `pages/02_input.py`: `st.set_page_config(page_title=\"ğŸ“¥ å…¥åŠ›æƒ…å ±\")`\n- `pages/03_model.py`: `st.set_page_config(page_title=\"ğŸ‘¤ ãƒ¢ãƒ‡ãƒ«è¨­å®š\")`\n- `pages/04_structure.py`: `st.set_page_config(page_title=\"ğŸ—ï¸ å…¨ä½“æ§‹æˆ\")`\n- etc...\n\nå„ãƒšãƒ¼ã‚¸ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç¢ºèªã—ã¦ã€åŒæ§˜ã®ä¿®æ­£ã‚’é©ç”¨ã—ã¦ãã ã•ã„ã€‚ã“ã‚Œã§ã‚µã‚¤ãƒ‰ãƒãƒ¼ã®ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãŒæ—¥æœ¬èªã§è¡¨ç¤ºã•ã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚",
    "timestamp": "2026-01-04T11:40:31.006637"
  },
  {
    "role": "user",
    "content": "ä»Šã€å·¦ã®ã‚¿ãƒ–ãŒè‹±èªã ã‘ã©æ—¥æœ¬èªã«ä¿®æ­£ã—ãŸã„ã€‚",
    "images": [],
    "timestamp": "2026-01-04T11:50:46.736091"
  },
  {
    "role": "assistant",
    "content": "ç¾çŠ¶ã‚’ç¢ºèªã—ã¾ã—ãŸã€‚å„ãƒšãƒ¼ã‚¸ãƒ•ã‚¡ã‚¤ãƒ«ã§`st.set_page_config(page_title=\"...\")`ã‚’è¨­å®šã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ã™ã¹ã¦ã®ãƒšãƒ¼ã‚¸ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ—¥æœ¬èªã‚¿ã‚¤ãƒˆãƒ«ã§ä¿®æ­£ã—ã¾ã™ã€‚\n\n===FILE: pages/02_input.py===\n```python\nimport streamlit as st\nfrom modules.data_store import DataStore\nfrom modules.file_parser import FileParser\nfrom modules.image_analyzer import ImageAnalyzer\nfrom modules.ai_provider import AIProvider\nfrom modules.prompt_manager import PromptManager\nfrom modules.settings_manager import SettingsManager\nimport os\nfrom pathlib import Path\n\n# ãƒšãƒ¼ã‚¸è¨­å®šï¼ˆã‚µã‚¤ãƒ‰ãƒãƒ¼ã§ã®è¡¨ç¤ºåã‚’æ—¥æœ¬èªã«ï¼‰\nst.set_page_config(page_title=\"å…¥åŠ›æƒ…å ±\")\n\ndef render_input_page():\n    '''å…¥åŠ›æƒ…å ±ãƒšãƒ¼ã‚¸ã®ãƒ¡ã‚¤ãƒ³é–¢æ•°'''\n    st.title('ğŸ“¥ å…¥åŠ›æƒ…å ±')\n    \n    data_store = DataStore()\n    \n    # ç¾åœ¨ã®è£½å“IDã‚’å–å¾—\n    if 'current_product_id' not in st.session_state:\n        st.error(\"è£½å“IDãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚\")\n        return\n    \n    product_id = st.session_state['current_product_id']\n    \n    # å„ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°\n    render_product_images_upload(data_store, product_id)\n    render_competitor_urls_input(data_store, product_id)\n    render_sheets_upload(data_store, product_id)\n    render_reference_images_upload(data_store, product_id)\n\ndef render_product_images_upload(data_store, product_id):\n    '''è£½å“ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰'''\n    st.subheader(\"è£½å“ç”»åƒ\")\n    \n    uploaded_files = st.file_uploader(\n        \"è£½å“ç”»åƒã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦ãã ã•ã„\",\n        type=['png', 'jpg', 'jpeg'],\n        accept_multiple_files=True,\n        key=\"product_images\"\n    )\n    \n    if uploaded_files:\n        upload_dir = Path(f\"data/uploads/{product_id}/product_images\")\n        upload_dir.mkdir(parents=True, exist_ok=True)\n        \n        image_paths = []\n        for uploaded_file in uploaded_files:\n            file_path = upload_dir / uploaded_file.name\n            with open(file_path, \"wb\") as f:\n                f.write(uploaded_file.getbuffer())\n            image_paths.append(str(file_path))\n            st.success(f\"ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å®Œäº†: {uploaded_file.name}\")\n        \n        # ãƒ‡ãƒ¼ã‚¿ã‚’æ›´æ–°\n        product = data_store.get_product(product_id)\n        if not product:\n            product = {}\n        product['product_images'] = image_paths\n        data_store.update_product(product_id, product)\n\ndef render_competitor_urls_input(data_store, product_id):\n    '''ç«¶åˆURLå…¥åŠ›'''\n    st.subheader(\"ç«¶åˆURL\")\n    \n    competitor_urls = st.text_area(\n        \"ç«¶åˆURLã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼ˆ1è¡Œ1URLï¼‰\",\n        height=150,\n        key=\"competitor_urls\"\n    )\n    \n    if competitor_urls:\n        urls = [url.strip() for url in competitor_urls.split('\\n') if url.strip()]\n        \n        # ãƒ‡ãƒ¼ã‚¿ã‚’æ›´æ–°\n        product = data_store.get_product(product_id)\n        if not product:\n            product = {}\n        product['competitor_urls'] = urls\n        data_store.update_product(product_id, product)\n\ndef render_sheets_upload(data_store, product_id):\n    '''å„ç¨®ã‚·ãƒ¼ãƒˆã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰'''\n    st.subheader(\"ãƒ‡ãƒ¼ã‚¿ã‚·ãƒ¼ãƒˆ\")\n    \n    col1, col2 = st.columns(2)\n    \n    with col1:\n        product_sheet = st.file_uploader(\n            \"è£½å“æƒ…å ±ã‚·ãƒ¼ãƒˆ\",\n            type=['xlsx', 'csv'],\n            key=\"product_sheet\"\n        )\n        \n        if product_sheet:\n            upload_dir = Path(f\"data/uploads/{product_id}/sheets\")\n            upload_dir.mkdir(parents=True, exist_ok=True)\n            \n            file_path = upload_dir / f\"product_sheet_{product_sheet.name}\"\n            with open(file_path, \"wb\") as f:\n                f.write(product_sheet.getbuffer())\n            \n            # ãƒ•ã‚¡ã‚¤ãƒ«ã‚’è§£æ\n            file_parser = FileParser()\n            try:\n                parsed_data = file_parser.parse_file(str(file_path))\n                \n                # ãƒ‡ãƒ¼ã‚¿ã‚’æ›´æ–°\n                product = data_store.get_product(product_id)\n                if not product:\n                    product = {}\n                product['product_sheet'] = str(file_path)\n                product['product_sheet_data'] = parsed_data\n                data_store.update_product(product_id, product)\n                \n                st.success(\"è£½å“æƒ…å ±ã‚·ãƒ¼ãƒˆã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¾ã—ãŸ\")\n            except Exception as e:\n                st.error(f\"ãƒ•ã‚¡ã‚¤ãƒ«è§£æã‚¨ãƒ©ãƒ¼: {e}\")\n    \n    with col2:\n        review_sheet = st.file_uploader(\n            \"ç«¶åˆãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚·ãƒ¼ãƒˆ\",\n            type=['xlsx', 'csv'],\n            key=\"review_sheet\"\n        )\n        \n        if review_sheet:\n            upload_dir = Path(f\"data/uploads/{product_id}/sheets\")\n            upload_dir.mkdir(parents=True, exist_ok=True)\n            \n            file_path = upload_dir / f\"review_sheet_{review_sheet.name}\"\n            with open(file_path, \"wb\") as f:\n                f.write(review_sheet.getbuffer())\n            \n            # ãƒ•ã‚¡ã‚¤ãƒ«ã‚’è§£æ\n            file_parser = FileParser()\n            try:\n                parsed_data = file_parser.parse_file(str(file_path))\n                \n                # ãƒ‡ãƒ¼ã‚¿ã‚’æ›´æ–°\n                product = data_store.get_product(product_id)\n                if not product:\n                    product = {}\n                product['review_sheet'] = str(file_path)\n                product['review_sheet_data'] = parsed_data\n                data_store.update_product(product_id, product)\n                \n                st.success(\"ç«¶åˆãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚·ãƒ¼ãƒˆã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¾ã—ãŸ\")\n            except Exception as e:\n                st.error(f\"ãƒ•ã‚¡ã‚¤ãƒ«è§£æã‚¨ãƒ©ãƒ¼: {e}\")\n\ndef render_reference_images_upload(data_store, product_id):\n    '''å‚è€ƒç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰'''\n    st.subheader(\"å‚è€ƒç”»åƒ\")\n    \n    col1, col2 = st.columns(2)\n    \n    with col1:\n        st.write(\"**å‚è€ƒLPç”»åƒ**\")\n        lp_images = st.file_uploader(\n            \"å‚è€ƒLPç”»åƒã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦ãã ã•ã„\",\n            type=['png', 'jpg', 'jpeg'],\n            accept_multiple_files=True,\n            key=\"lp_images\"\n        )\n        \n        if lp_images:\n            upload_dir = Path(f\"data/uploads/{product_id}/reference_lp\")\n            upload_dir.mkdir(parents=True, exist_ok=True)\n            \n            image_paths = []\n            for uploaded_file in lp_images:\n                file_path = upload_dir / uploaded_file.name\n                with open(file_path, \"wb\") as f:\n                    f.write(uploaded_file.getbuffer())\n                image_paths.append(str(file_path))\n                st.success(f\"ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å®Œäº†: {uploaded_file.name}\")\n            \n            # ãƒ‡ãƒ¼ã‚¿ã‚’æ›´æ–°\n            product = data_store.get_product(product_id)\n            if not product:\n                product = {}\n            product['reference_lp_images'] = image_paths\n            data_store.update_product(product_id, product)\n    \n    with col2:\n        st.write(\"**ãƒˆãƒ³ãƒãƒŠå‚è€ƒç”»åƒ**\")\n        tone_images = st.file_uploader(\n            \"ãƒˆãƒ³ãƒãƒŠå‚è€ƒç”»åƒã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦ãã ã•ã„\",\n            type=['png', 'jpg', 'jpeg'],\n            accept_multiple_files=True,\n            key=\"tone_images\"\n        )\n        \n        if tone_images:\n            upload_dir = Path(f\"data/uploads/{product_id}/tone_manner\")\n            upload_dir.mkdir(parents=True, exist_ok=True)\n            \n            image_paths = []\n            for uploaded_file in tone_images:\n                file_path = upload_dir / uploaded_file.name\n                with open(file_path, \"wb\") as f:\n                    f.write(uploaded_file.getbuffer())\n                image_paths.append(str(file_path))\n                st.success(f\"ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å®Œäº†: {uploaded_file.name}\")\n            \n            # ãƒ‡ãƒ¼ã‚¿ã‚’æ›´æ–°\n            product = data_store.get_product(product_id)\n            if not product:\n                product = {}\n            product['tone_manner_images'] = image_paths\n            data_store.update_product(product_id, product)\n    \n    # å‚è€ƒç”»åƒåˆ†æãƒœã‚¿ãƒ³\n    if st.button('å‚è€ƒç”»åƒã‹ã‚‰æ§‹æˆã‚’åˆ†æ'):\n        product = data_store.get_product(product_id)\n        if product and 'reference_lp_images' in product:\n            settings_manager = SettingsManager()\n            settings = settings_manager.get_settings()\n            ai_provider = AIProvider(settings)\n            prompt_manager = PromptManager()\n            image_analyzer = ImageAnalyzer(ai_provider, prompt_manager)\n            analyze_reference_images(image_analyzer, product['reference_lp_images'], product_id, data_store)\n        else:\n            st.warning(\"å‚è€ƒLPç”»åƒãŒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã•ã‚Œã¦ã„ã¾ã›ã‚“\")\n\ndef analyze_reference_images(image_analyzer, image_paths, product_id, data_store):\n    '''å‚è€ƒç”»åƒã‹ã‚‰æ§‹æˆã‚’åˆ†æ'''\n    with st.spinner('å‚è€ƒç”»åƒã‚’åˆ†æä¸­...'):\n        try:\n            analysis_results = []\n            for image_path in image_paths:\n                if os.path.exists(image_path):\n                    result = image_analyzer.analyze_image(image_path)\n                    analysis_results.append(result)\n            \n            if analysis_results:\n                # åˆ†æçµæœã‚’çµ±åˆã—ã¦æ§‹æˆæƒ…å ±ã‚’ç”Ÿæˆ\n                structure_data = {\n                    'analysis_results': analysis_results,\n                    'analyzed_at': st.session_state.get('timestamp', ''),\n                    'image_count': len(analysis_results)\n                }\n                \n                # ãƒ‡ãƒ¼ã‚¿ã‚’æ›´æ–°\n                product = data_store.get_product(product_id)\n                if not product:\n                    product = {}\n                product['structure'] = structure_data\n                data_store.update_product(product_id, product)\n                \n                st.success(f\"{len(analysis_results)}ä»¶ã®ç”»åƒã‚’åˆ†æã—ã¾ã—ãŸ\")\n            else:\n                st.error(\"ç”»åƒã®åˆ†æã«å¤±æ•—ã—ã¾ã—ãŸ\")\n                \n        except Exception as e:\n            st.error(f\"åˆ†æã‚¨ãƒ©ãƒ¼: {e}\")\n\nrender_input_page()\n```\n\n===FILE: pages/03_model.py===\n```python\nimport streamlit as st\nimport base64\nfrom modules.model_generator import ModelGenerator\nfrom modules.ai_provider import AIProvider\nfrom modules.prompt_manager import PromptManager\nfrom modules.settings_manager import SettingsManager\n\n# ãƒšãƒ¼ã‚¸è¨­å®šï¼ˆã‚µã‚¤ãƒ‰ãƒãƒ¼ã§ã®è¡¨ç¤ºåã‚’æ—¥æœ¬èªã«ï¼‰\nst.set_page_config(page_title=\"ãƒ¢ãƒ‡ãƒ«è¨­å®š\")\n\ndef render_model_page():\n    st.title('ğŸ‘¤ ãƒ¢ãƒ‡ãƒ«è¨­å®š')\n    \n    # åˆæœŸåŒ–\n    settings_manager = SettingsManager()\n    settings = settings_manager.get_settings()\n    ai_provider = AIProvider(settings)\n    prompt_manager = PromptManager()\n    model_generator = ModelGenerator(ai_provider, prompt_manager)\n    \n    # ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹åˆæœŸåŒ–\n    if 'model_images' not in st.session_state:\n        st.session_state.model_images = [None] * 5\n    if 'model_prompts' not in st.session_state:\n        st.session_state.model_prompts = [None] * 5\n    \n    # ãƒ¢ãƒ‡ãƒ«æ•°é¸æŠ\n    num_models = st.slider('ãƒ¢ãƒ‡ãƒ«äººæ•°', 1, 5, 3)\n    \n    st.markdown(\"---\")\n    \n    # å„ãƒ¢ãƒ‡ãƒ«ã®è¨­å®š\n    tabs = st.tabs([f\"ãƒ¢ãƒ‡ãƒ«{i+1}\" for i in range(num_models)])\n    \n    options = model_generator.get_attribute_options()\n    \n    for i, tab in enumerate(tabs):\n        with tab:\n            render_model_config(i, options, model_generator)\n    \n    st.markdown(\"---\")\n    \n    # ä¸€æ‹¬ç”Ÿæˆãƒœã‚¿ãƒ³\n    if st.button('ğŸ¨ é¸æŠä¸­ã®ãƒ¢ãƒ‡ãƒ«ã‚’å…¨ã¦ç”Ÿæˆ', type='primary', key='generate_all_btn'):\n        generate_all_models(model_generator, num_models)\n    \n    # ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç¢ºèªã‚»ã‚¯ã‚·ãƒ§ãƒ³\n    with st.expander(\"ğŸ” ç”Ÿæˆãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç¢ºèªï¼ˆAIãŒæœ€é©åŒ–ï¼‰\", expanded=False):\n        for i in range(num_models):\n            if st.session_state.model_prompts[i]:\n                st.markdown(f\"**ãƒ¢ãƒ‡ãƒ«{i+1}:**\")\n                st.code(st.session_state.model_prompts[i], language=None)\n                st.markdown(\"---\")\n\ndef render_model_config(index: int, options: dict, model_generator):\n    \"\"\"å„ãƒ¢ãƒ‡ãƒ«ã®è¨­å®šUI\"\"\"\n    \n    col1, col2 = st.columns([2, 1])\n    \n    with col1:\n        st.subheader(f\"ãƒ¢ãƒ‡ãƒ«{index+1} å±æ€§è¨­å®š\")\n        \n        c1, c2, c3 = st.columns(3)\n        \n        with c1:\n            age = st.selectbox('å¹´é½¢', options.get('age', []), key=f'model_age_{index}')\n            ethnicity = st.selectbox('äººç¨®', options.get('ethnicity', []), key=f'model_eth_{index}')\n        \n        with c2:\n            gender = st.selectbox('æ€§åˆ¥', options.get('gender', []), key=f'model_gender_{index}')\n            atmosphere = st.selectbox('é›°å›²æ°—', options.get('atmosphere', []), key=f'model_atm_{index}')\n        \n        with c3:\n            clothing = st.selectbox('æœè£…', options.get('clothing', []), key=f'model_cloth_{index}')\n        \n        # ã‚«ã‚¹ã‚¿ãƒ æŒ‡ç¤º\n        custom_prompt = st.text_area(\n            'ğŸ“ è¿½åŠ æŒ‡ç¤ºãƒ»å‚™è€ƒï¼ˆAIãŒãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã«åæ˜ ï¼‰',\n            placeholder='ä¾‹: ç¬‘é¡”ã§è¦ªã—ã¿ã‚„ã™ã„ã€çœ¼é¡ã‚’ã‹ã‘ã¦ã„ã‚‹ã€çŸ­é«ªã€ç™½ã„èƒŒæ™¯',\n            key=f'model_custom_{index}',\n            height=100\n        )\n        \n        # ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰\n        uploaded_file = st.file_uploader(\n            'æ—¢å­˜ç”»åƒã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰',\n            type=['png', 'jpg', 'jpeg'],\n            key=f'model_upload_{index}'\n        )\n        \n        if uploaded_file:\n            image_bytes = uploaded_file.read()\n            st.session_state.model_images[index] = base64.b64encode(image_bytes).decode()\n            st.success('ç”»åƒã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¾ã—ãŸ')\n        \n        # ãƒœã‚¿ãƒ³\n        bc1, bc2, bc3 = st.columns(3)\n        with bc1:\n            if st.button('ğŸ¨ ç”Ÿæˆ', key=f'model_generate_btn_{index}', type='primary'):\n                generate_single_model(model_generator, index, {\n                    'age': age,\n                    'ethnicity': ethnicity,\n                    'gender': gender,\n                    'atmosphere': atmosphere,\n                    'clothing': clothing\n                }, custom_prompt)\n        with bc2:\n            if st.button('ğŸ“‹ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç¢ºèª', key=f'model_preview_btn_{index}'):\n                preview_prompt(model_generator, index, {\n                    'age': age,\n                    'ethnicity': ethnicity,\n                    'gender': gender,\n                    'atmosphere': atmosphere,\n                    'clothing': clothing\n                }, custom_prompt)\n        with bc3:\n            if st.button('ğŸ—‘ï¸ ã‚¯ãƒªã‚¢', key=f'model_clear_btn_{index}'):\n                st.session_state.model_images[index] = None\n                st.session_state.model_prompts[index] = None\n                st.rerun()\n    \n    with col2:\n        st.subheader(\"ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼\")\n        if st.session_state.model_images[index]:\n            try:\n                image_bytes = base64.b64decode(st.session_state.model_images[index])\n                st.image(image_bytes, use_container_width=True)\n            except:\n                st.info(\"ç”»åƒã‚’ç”Ÿæˆã—ã¦ãã ã•ã„\")\n        else:\n            st.info(\"ç”»åƒã‚’ç”Ÿæˆã—ã¦ãã ã•ã„\")\n        \n        if st.session_state.model_prompts[index]:\n            with st.expander(\"ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ\", expanded=False):\n                st.code(st.session_state.model_prompts[index], language=None)\n\ndef preview_prompt(model_generator, index: int, attributes: dict, custom_notes: str):\n    \"\"\"ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã®ã¿ã‚’ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ï¼ˆAIã§æœ€é©åŒ–ï¼‰\"\"\"\n    with st.spinner('AIãŒãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’æœ€é©åŒ–ä¸­...'):\n        try:\n            # ModelGeneratorã®generate_optimized_promptã‚’ä½¿ç”¨ï¼ˆå†…éƒ¨ã§PromptOptimizerã‚’å‘¼ã¶ï¼‰\n            prompt = model_generator.generate_optimized_prompt(attributes, custom_notes)\n            st.session_state.model_prompts[index] = prompt\n            st.success('ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç”Ÿæˆå®Œäº†')\n            st.rerun()\n        except Exception as e:\n            st.error(f'ã‚¨ãƒ©ãƒ¼: {str(e)}')\n\ndef generate_single_model(model_generator, index: int, attributes: dict, custom_notes: str):\n    \"\"\"å˜ä¸€ãƒ¢ãƒ‡ãƒ«ç”Ÿæˆï¼ˆAIã§ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆæœ€é©åŒ– + ç”»åƒç”Ÿæˆï¼‰\"\"\"\n    with st.spinner(f'ãƒ¢ãƒ‡ãƒ«{index+1}ã‚’ç”Ÿæˆä¸­... (AIãƒ—ãƒ­ãƒ³ãƒ—ãƒˆæœ€é©åŒ– + ç”»åƒç”Ÿæˆã§1-2åˆ†)'):\n        try:\n            # AIã§ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’æœ€é©åŒ–\n            prompt = model_generator.generate_optimized_prompt(attributes, custom_notes)\n            st.session_state.model_prompts[index] = prompt\n            \n            # ç”»åƒç”Ÿæˆ\n            from modules.image_generator import ImageGenerator\n            image_gen = ImageGenerator()\n            image_data = image_gen.generate(prompt)\n            \n            if image_data:\n                st.session_state.model_images[index] = image_data\n                st.success(f'ãƒ¢ãƒ‡ãƒ«{index+1}ã‚’ç”Ÿæˆã—ã¾ã—ãŸ')\n                st.rerun()\n            else:\n                st.error('ç”»åƒç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸ')\n        except Exception as e:\n            st.error(f'ã‚¨ãƒ©ãƒ¼: {str(e)}')\n\ndef generate_all_models(model_generator, num_models: int):\n    \"\"\"å…¨ãƒ¢ãƒ‡ãƒ«ä¸€æ‹¬ç”Ÿæˆ\"\"\"\n    progress = st.progress(0)\n    \n    for i in range(num_models):\n        progress.progress((i) / num_models, f'ãƒ¢ãƒ‡ãƒ«{i+1}ã‚’ç”Ÿæˆä¸­...')\n        \n        attributes = {\n            'age': st.session_state.get(f'model_age_{i}', '30ä»£'),\n            'ethnicity': st.session_state.get(f'model_eth_{i}', 'ã‚¢ã‚¸ã‚¢ç³»'),\n            'gender': st.session_state.get(f'model_gender_{i}', 'ç”·æ€§'),\n            'atmosphere': st.session_state.get(f'model_atm_{i}', 'ãƒŠãƒãƒ¥ãƒ©ãƒ«'),\n            'clothing': st.session_state.get(f'model_cloth_{i}', 'ãƒ“ã‚¸ãƒã‚¹')\n        }\n        custom_notes = st.session_state.get(f'model_custom_{i}', '')\n        \n        # æ—¢å­˜ç”»åƒãŒãªã‘ã‚Œã°ç”Ÿæˆ\n        if not st.session_state.model_images[i]:\n            try:\n                # AIã§ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆæœ€é©åŒ–\n                prompt = model_generator.generate_optimized_prompt(attributes, custom_notes)\n                st.session_state.model_prompts[i] = prompt\n                \n                # ç”»åƒç”Ÿæˆ\n                from modules.image_generator import ImageGenerator\n                image_gen = ImageGenerator()\n                image_data = image_gen.generate(prompt)\n                \n                if image_data:\n                    st.session_state.model_images[i] = image_data\n            except Exception as e:\n                st.error(f'ãƒ¢ãƒ‡ãƒ«{i+1}ç”Ÿæˆã‚¨ãƒ©ãƒ¼: {str(e)}')\n    \n    progress.progress(1.0, 'å®Œäº†!')\n    st.success('å…¨ãƒ¢ãƒ‡ãƒ«ã®ç”ŸæˆãŒå®Œäº†ã—ã¾ã—ãŸ')\n    st.rerun()\n\nrender_model_page()\n```\n\n===FILE: pages/04_structure.py===\n```python\nimport streamlit as st\nfrom modules.data_store import DataStore\n\n# ãƒšãƒ¼ã‚¸è¨­å®šï¼ˆã‚µã‚¤ãƒ‰ãƒãƒ¼ã§ã®è¡¨ç¤ºåã‚’æ—¥æœ¬èªã«ï¼‰\nst.set_page_config(page_title=\"å…¨ä½“æ§‹æˆ\")\n\ndef render_structure_page():\n    '''å…¨ä½“æ§‹æˆãƒšãƒ¼ã‚¸ã®ãƒ¡ã‚¤ãƒ³é–¢æ•°'''\n    st.title('ğŸ—ï¸ å…¨ä½“æ§‹æˆ')\n    \n    data_store = DataStore()\n    \n    # ç¾åœ¨ã®å•†å“IDã‚’å–å¾—\n    if 'current_product_id' not in st.session_state:\n        st.warning(\"å•†å“ãŒé¸æŠã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚å…¥åŠ›ç”»é¢ã‹ã‚‰å•†å“ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚\")\n        return\n    \n    product_id = st.session_state.current_product_id\n    product = data_store.get_product(product_id)\n    \n    if not product:\n        st.error(\"å•†å“ãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚\")\n        return\n    \n    # å‚è€ƒç”»åƒã‹ã‚‰æ§‹æˆã‚’åˆ†æãƒœã‚¿ãƒ³\n    col1, col2 = st.columns([2, 1])\n    with col1:\n        if st.button(\"ğŸ“Š å‚è€ƒç”»åƒã‹ã‚‰æ§‹æˆã‚’åˆ†æ\", type=\"primary\"):\n            with st.spinner(\"æ§‹æˆã‚’åˆ†æä¸­...\"):\n                # åˆ†æå‡¦ç†ã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ\n                st.success(\"æ§‹æˆã®åˆ†æãŒå®Œäº†ã—ã¾ã—ãŸã€‚\")\n                st.rerun()\n    \n    # æ§‹æˆãƒ‡ãƒ¼ã‚¿ã®å–å¾—\n    structure = product.get('structure', {})\n    pages = structure.get('pages', [])\n    \n    if not pages:\n        # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®æ§‹æˆã‚’ä½œæˆ\n        default_pages = [\n            {\n                'id': 'first_view',\n                'order': 1,\n                'type': 'first_view',\n                'title': 'ãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆãƒ“ãƒ¥ãƒ¼',\n                'summary': 'è¨ªå•è€…ã®æ³¨æ„ã‚’å¼•ãæœ€åˆã®ç”»é¢',\n                'elements': ['ãƒ¡ã‚¤ãƒ³ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«', 'ã‚­ãƒ£ãƒƒãƒã‚³ãƒ”ãƒ¼', 'CTAãƒœã‚¿ãƒ³']\n            },\n            {\n                'id': 'comparison',\n                'order': 2,\n                'type': 'comparison',\n                'title': 'æ¯”è¼ƒè¡¨',\n                'summary': 'å•†å“ãƒ»ã‚µãƒ¼ãƒ“ã‚¹ã®æ¯”è¼ƒæƒ…å ±',\n                'elements': ['æ¯”è¼ƒè¡¨', 'ç‰¹å¾´èª¬æ˜', 'ä¾¡æ ¼æ¯”è¼ƒ']\n            },\n            {\n                'id': 'features',\n                'order': 3,\n                'type': 'features',\n                'title': 'ç‰¹å¾´ãƒ»æ©Ÿèƒ½',\n                'summary': 'å•†å“ã®ç‰¹å¾´ã‚„æ©Ÿèƒ½ã®è©³ç´°èª¬æ˜',\n                'elements': ['æ©Ÿèƒ½ä¸€è¦§', 'è©³ç´°èª¬æ˜', 'ç”»åƒãƒ»å‹•ç”»']\n            }\n        ]\n        \n        # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆæ§‹æˆã‚’ä¿å­˜\n        if 'structure' not in product:\n            product['structure'] = {}\n        product['structure']['pages'] = default_pages\n        data_store.update_product(product_id, product)\n        pages = default_pages\n    \n    # ãƒšãƒ¼ã‚¸ãƒªã‚¹ãƒˆã®è¡¨ç¤º\n    render_page_list(structure, data_store, product_id)\n\ndef render_page_list(structure, data_store, product_id):\n    '''ãƒšãƒ¼ã‚¸ãƒªã‚¹ãƒˆè¡¨ç¤º'''\n    product = data_store.get_product(product_id)\n    pages = product.get('structure', {}).get('pages', [])\n    \n    if not pages:\n        st.info(\"æ§‹æˆãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚\")\n        return\n    \n    # ãƒšãƒ¼ã‚¸ã®é †åºã§ã‚½ãƒ¼ãƒˆ\n    pages_sorted = sorted(pages, key=lambda x: x.get('order', 0))\n    \n    st.subheader(\"ğŸ“„ ãƒšãƒ¼ã‚¸æ§‹æˆ\")\n    \n    for index, page in enumerate(pages_sorted):\n        render_page_item(page, index, data_store, product_id)\n\ndef render_page_item(page, index, data_store, product_id):\n    '''å˜ä¸€ãƒšãƒ¼ã‚¸é …ç›®'''\n    page_order = page.get('order', index + 1)\n    page_title = page.get('title', 'ã‚¿ã‚¤ãƒˆãƒ«æœªè¨­å®š')\n    page_summary = page.get('summary', 'æ¦‚è¦æœªè¨­å®š')\n    page_elements = page.get('elements', [])\n    \n    # expander ã§æŠ˜ã‚Šç•³ã¿è¡¨ç¤º\n    with st.expander(f\"P{page_order} - {page_title}\", expanded=False):\n        col1, col2 = st.columns([3, 1])\n        \n        with col1:\n            st.write(f\"**æ¦‚è¦:** {page_summary}\")\n            \n            if page_elements:\n                st.write(\"**æ§‹æˆè¦ç´ :**\")\n                for element in page_elements:\n                    st.write(f\"â€¢ {element}\")\n            else:\n                st.write(\"æ§‹æˆè¦ç´ ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚\")\n        \n        with col2:\n            # ç·¨é›†ãƒœã‚¿ãƒ³\n            edit_key = f\"edit_{page.get('id', index)}\"\n            if st.button(\"âœï¸ ç·¨é›†\", key=edit_key):\n                edit_page(page.get('id', index), data_store, product_id)\n            \n            # ä¸Šä¸‹ç§»å‹•ãƒœã‚¿ãƒ³\n            move_up_key = f\"move_up_{page.get('id', index)}\"\n            move_down_key = f\"move_down_{page.get('id', index)}\"\n            \n            if page_order > 1:\n                if st.button(\"â¬†ï¸\", key=move_up_key, help=\"ä¸Šã«ç§»å‹•\"):\n                    update_page_order_up(page, data_store, product_id)\n            \n            product = data_store.get_product(product_id)\n            pages = product.get('structure', {}).get('pages', [])\n            if page_order < len(pages):\n                if st.button(\"â¬‡ï¸\", key=move_down_key, help=\"ä¸‹ã«ç§»å‹•\"):\n                    update_page_order_down(page, data_store, product_id)\n\ndef update_page_order(pages, data_store, product_id):\n    '''ãƒšãƒ¼ã‚¸é †åºæ›´æ–°'''\n    product = data_store.get_product(product_id)\n    if product:\n        product['structure']['pages'] = pages\n        data_store.update_product(product_id, product)\n        st.rerun()\n\ndef update_page_order_up(page, data_store, product_id):\n    '''ãƒšãƒ¼ã‚¸ã‚’ä¸Šã«ç§»å‹•'''\n    product = data_store.get_product(product_id)\n    pages = product.get('structure', {}).get('pages', [])\n    \n    current_order = page.get('order', 0)\n    if current_order > 1:\n        # ç¾åœ¨ã®ãƒšãƒ¼ã‚¸ã®é †åºã‚’ä¸Šã’ã‚‹\n        for p in pages:\n            if p.get('id') == page.get('id'):\n                p['order'] = current_order - 1\n            elif p.get('order') == current_order - 1:\n                p['order'] = current_order\n        \n        product['structure']['pages'] = pages\n        data_store.update_product(product_id, product)\n        st.rerun()\n\ndef update_page_order_down(page, data_store, product_id):\n    '''ãƒšãƒ¼ã‚¸ã‚’ä¸‹ã«ç§»å‹•'''\n    product = data_store.get_product(product_id)\n    pages = product.get('structure', {}).get('pages', [])\n    \n    current_order = page.get('order', 0)\n    max_order = len(pages)\n    \n    if current_order < max_order:\n        # ç¾åœ¨ã®ãƒšãƒ¼ã‚¸ã®é †åºã‚’ä¸‹ã’ã‚‹\n        for p in pages:\n            if p.get('id') == page.get('id'):\n                p['order'] = current_order + 1\n            elif p.get('order') == current_order + 1:\n                p['order'] = current_order\n        \n        product['structure']['pages'] = pages\n        data_store.update_product(product_id, product)\n        st.rerun()\n\ndef edit_page(page_id, data_store, product_id):\n    '''ãƒšãƒ¼ã‚¸ç·¨é›†'''\n    product = data_store.get_product(product_id)\n    pages = product.get('structure', {}).get('pages', [])\n    \n    # ç·¨é›†å¯¾è±¡ã®ãƒšãƒ¼ã‚¸ã‚’å–å¾—\n    target_page = None\n    for page in pages:\n        if page.get('id') == page_id:\n            target_page = page\n            break\n    \n    if not target_page:\n        st.error(\"ç·¨é›†å¯¾è±¡ã®ãƒšãƒ¼ã‚¸ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚\")\n        return\n    \n    # ç·¨é›†ãƒ•ã‚©ãƒ¼ãƒ \n    st.subheader(f\"âœï¸ ãƒšãƒ¼ã‚¸ç·¨é›†: {target_page.get('title', '')}\")\n    \n    with st.form(f\"edit_form_{page_id}\"):\n        new_title = st.text_input(\"ã‚¿ã‚¤ãƒˆãƒ«\", value=target_page.get('title', ''))\n        new_summary = st.text_area(\"æ¦‚è¦\", value=target_page.get('summary', ''))\n        \n        # æ§‹æˆè¦ç´ ã®ç·¨é›†\n        elements = target_page.get('elements', [])\n        elements_text = '\\n'.join(elements)\n        new_elements_text = st.text_area(\"æ§‹æˆè¦ç´ ï¼ˆ1è¡Œã«1ã¤ãšã¤ï¼‰\", value=elements_text)\n        \n        col1, col2 = st.columns(2)\n        with col1:\n            if st.form_submit_button(\"ğŸ’¾ ä¿å­˜\", type=\"primary\"):\n                # æ›´æ–°å‡¦ç†\n                target_page['title'] = new_title\n                target_page['summary'] = new_summary\n                target_page['elements'] = [elem.strip() for elem in new_elements_text.split('\\n') if elem.strip()]\n                ",
    "timestamp": "2026-01-04T11:53:50.607092"
  },
  {
    "role": "user",
    "content": "ã€Œã‚µã‚¤ãƒ‰ãƒãƒ¼ã®ãƒšãƒ¼ã‚¸åã‚’æ—¥æœ¬èªã«ã—ãŸã„ã€‚æ­£ã—ã„æ–¹æ³•ã‚’èª¿æŸ»ã—ã¦ã€",
    "images": [],
    "timestamp": "2026-01-04T12:55:44.843596"
  },
  {
    "role": "assistant",
    "content": "èª¿æŸ»çµæœã‚’ç¢ºèªã—ã¾ã—ãŸã€‚Streamlitã§ã‚µã‚¤ãƒ‰ãƒãƒ¼ã®ãƒšãƒ¼ã‚¸åã‚’æ—¥æœ¬èªã«ã™ã‚‹ã«ã¯ã€å„ãƒšãƒ¼ã‚¸ãƒ•ã‚¡ã‚¤ãƒ«ã§`st.set_page_config(page_title=\"æ—¥æœ¬èªå\")`ã‚’è¨­å®šã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚\n\nç¾åœ¨ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç¢ºèªã—ã¦ã€ã™ã¹ã¦ã®ãƒšãƒ¼ã‚¸ãƒ•ã‚¡ã‚¤ãƒ«ã«æ—¥æœ¬èªã‚¿ã‚¤ãƒˆãƒ«ã‚’è¨­å®šã—ã¾ã™ï¼š\n\n===FILE: pages/01_product_list.py===\n```python\nimport streamlit as st\n\n# ãƒšãƒ¼ã‚¸è¨­å®šï¼ˆã‚µã‚¤ãƒ‰ãƒãƒ¼ã§ã®è¡¨ç¤ºåã‚’æ—¥æœ¬èªã«ï¼‰\nst.set_page_config(page_title=\"è£½å“ä¸€è¦§\")\n\nst.title(\"ğŸ“‹ è£½å“ä¸€è¦§\")\n\n# ä»¥ä¸‹ã€æ—¢å­˜ã®ã‚³ãƒ¼ãƒ‰\n```\n\n===FILE: pages/02_input.py===\n```python\nimport streamlit as st\nfrom modules.data_store import DataStore\nfrom modules.file_parser import FileParser\nfrom modules.image_analyzer import ImageAnalyzer\nfrom modules.ai_provider import AIProvider\nfrom modules.prompt_manager import PromptManager\nfrom modules.settings_manager import SettingsManager\nimport os\nfrom pathlib import Path\n\n# ãƒšãƒ¼ã‚¸è¨­å®šï¼ˆã‚µã‚¤ãƒ‰ãƒãƒ¼ã§ã®è¡¨ç¤ºåã‚’æ—¥æœ¬èªã«ï¼‰\nst.set_page_config(page_title=\"å…¥åŠ›æƒ…å ±\")\n\ndef render_input_page():\n    '''å…¥åŠ›æƒ…å ±ãƒšãƒ¼ã‚¸ã®ãƒ¡ã‚¤ãƒ³é–¢æ•°'''\n    st.title('ğŸ“¥ å…¥åŠ›æƒ…å ±')\n    \n    data_store = DataStore()\n    \n    # ç¾åœ¨ã®è£½å“IDã‚’å–å¾—\n    if 'current_product_id' not in st.session_state:\n        st.error(\"è£½å“IDãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚\")\n        return\n    \n    product_id = st.session_state['current_product_id']\n    \n    # å„ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°\n    render_product_images_upload(data_store, product_id)\n    render_competitor_urls_input(data_store, product_id)\n    render_sheets_upload(data_store, product_id)\n    render_reference_images_upload(data_store, product_id)\n\ndef render_product_images_upload(data_store, product_id):\n    '''è£½å“ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰'''\n    st.subheader(\"è£½å“ç”»åƒ\")\n    \n    uploaded_files = st.file_uploader(\n        \"è£½å“ç”»åƒã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦ãã ã•ã„\",\n        type=['png', 'jpg', 'jpeg'],\n        accept_multiple_files=True,\n        key=\"product_images\"\n    )\n    \n    if uploaded_files:\n        upload_dir = Path(f\"data/uploads/{product_id}/product_images\")\n        upload_dir.mkdir(parents=True, exist_ok=True)\n        \n        image_paths = []\n        for uploaded_file in uploaded_files:\n            file_path = upload_dir / uploaded_file.name\n            with open(file_path, \"wb\") as f:\n                f.write(uploaded_file.getbuffer())\n            image_paths.append(str(file_path))\n            st.success(f\"ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å®Œäº†: {uploaded_file.name}\")\n        \n        # ãƒ‡ãƒ¼ã‚¿ã‚’æ›´æ–°\n        product = data_store.get_product(product_id)\n        if not product:\n            product = {}\n        product['product_images'] = image_paths\n        data_store.update_product(product_id, product)\n\ndef render_competitor_urls_input(data_store, product_id):\n    '''ç«¶åˆURLå…¥åŠ›'''\n    st.subheader(\"ç«¶åˆURL\")\n    \n    competitor_urls = st.text_area(\n        \"ç«¶åˆURLã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼ˆ1è¡Œ1URLï¼‰\",\n        height=150,\n        key=\"competitor_urls\"\n    )\n    \n    if competitor_urls:\n        urls = [url.strip() for url in competitor_urls.split('\\n') if url.strip()]\n        \n        # ãƒ‡ãƒ¼ã‚¿ã‚’æ›´æ–°\n        product = data_store.get_product(product_id)\n        if not product:\n            product = {}\n        product['competitor_urls'] = urls\n        data_store.update_product(product_id, product)\n\ndef render_sheets_upload(data_store, product_id):\n    '''å„ç¨®ã‚·ãƒ¼ãƒˆã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰'''\n    st.subheader(\"ãƒ‡ãƒ¼ã‚¿ã‚·ãƒ¼ãƒˆ\")\n    \n    col1, col2 = st.columns(2)\n    \n    with col1:\n        product_sheet = st.file_uploader(\n            \"è£½å“æƒ…å ±ã‚·ãƒ¼ãƒˆ\",\n            type=['xlsx', 'csv'],\n            key=\"product_sheet\"\n        )\n        \n        if product_sheet:\n            upload_dir = Path(f\"data/uploads/{product_id}/sheets\")\n            upload_dir.mkdir(parents=True, exist_ok=True)\n            \n            file_path = upload_dir / f\"product_sheet_{product_sheet.name}\"\n            with open(file_path, \"wb\") as f:\n                f.write(product_sheet.getbuffer())\n            \n            # ãƒ•ã‚¡ã‚¤ãƒ«ã‚’è§£æ\n            file_parser = FileParser()\n            try:\n                parsed_data = file_parser.parse_file(str(file_path))\n                \n                # ãƒ‡ãƒ¼ã‚¿ã‚’æ›´æ–°\n                product = data_store.get_product(product_id)\n                if not product:\n                    product = {}\n                product['product_sheet'] = str(file_path)\n                product['product_sheet_data'] = parsed_data\n                data_store.update_product(product_id, product)\n                \n                st.success(\"è£½å“æƒ…å ±ã‚·ãƒ¼ãƒˆã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¾ã—ãŸ\")\n            except Exception as e:\n                st.error(f\"ãƒ•ã‚¡ã‚¤ãƒ«è§£æã‚¨ãƒ©ãƒ¼: {e}\")\n    \n    with col2:\n        review_sheet = st.file_uploader(\n            \"ç«¶åˆãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚·ãƒ¼ãƒˆ\",\n            type=['xlsx', 'csv'],\n            key=\"review_sheet\"\n        )\n        \n        if review_sheet:\n            upload_dir = Path(f\"data/uploads/{product_id}/sheets\")\n            upload_dir.mkdir(parents=True, exist_ok=True)\n            \n            file_path = upload_dir / f\"review_sheet_{review_sheet.name}\"\n            with open(file_path, \"wb\") as f:\n                f.write(review_sheet.getbuffer())\n            \n            # ãƒ•ã‚¡ã‚¤ãƒ«ã‚’è§£æ\n            file_parser = FileParser()\n            try:\n                parsed_data = file_parser.parse_file(str(file_path))\n                \n                # ãƒ‡ãƒ¼ã‚¿ã‚’æ›´æ–°\n                product = data_store.get_product(product_id)\n                if not product:\n                    product = {}\n                product['review_sheet'] = str(file_path)\n                product['review_sheet_data'] = parsed_data\n                data_store.update_product(product_id, product)\n                \n                st.success(\"ç«¶åˆãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚·ãƒ¼ãƒˆã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¾ã—ãŸ\")\n            except Exception as e:\n                st.error(f\"ãƒ•ã‚¡ã‚¤ãƒ«è§£æã‚¨ãƒ©ãƒ¼: {e}\")\n\ndef render_reference_images_upload(data_store, product_id):\n    '''å‚è€ƒç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰'''\n    st.subheader(\"å‚è€ƒç”»åƒ\")\n    \n    col1, col2 = st.columns(2)\n    \n    with col1:\n        st.write(\"**å‚è€ƒLPç”»åƒ**\")\n        lp_images = st.file_uploader(\n            \"å‚è€ƒLPç”»åƒã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦ãã ã•ã„\",\n            type=['png', 'jpg', 'jpeg'],\n            accept_multiple_files=True,\n            key=\"lp_images\"\n        )\n        \n        if lp_images:\n            upload_dir = Path(f\"data/uploads/{product_id}/reference_lp\")\n            upload_dir.mkdir(parents=True, exist_ok=True)\n            \n            image_paths = []\n            for uploaded_file in lp_images:\n                file_path = upload_dir / uploaded_file.name\n                with open(file_path, \"wb\") as f:\n                    f.write(uploaded_file.getbuffer())\n                image_paths.append(str(file_path))\n                st.success(f\"ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å®Œäº†: {uploaded_file.name}\")\n            \n            # ãƒ‡ãƒ¼ã‚¿ã‚’æ›´æ–°\n            product = data_store.get_product(product_id)\n            if not product:\n                product = {}\n            product['reference_lp_images'] = image_paths\n            data_store.update_product(product_id, product)\n    \n    with col2:\n        st.write(\"**ãƒˆãƒ³ãƒãƒŠå‚è€ƒç”»åƒ**\")\n        tone_images = st.file_uploader(\n            \"ãƒˆãƒ³ãƒãƒŠå‚è€ƒç”»åƒã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦ãã ã•ã„\",\n            type=['png', 'jpg', 'jpeg'],\n            accept_multiple_files=True,\n            key=\"tone_images\"\n        )\n        \n        if tone_images:\n            upload_dir = Path(f\"data/uploads/{product_id}/tone_manner\")\n            upload_dir.mkdir(parents=True, exist_ok=True)\n            \n            image_paths = []\n            for uploaded_file in tone_images:\n                file_path = upload_dir / uploaded_file.name\n                with open(file_path, \"wb\") as f:\n                    f.write(uploaded_file.getbuffer())\n                image_paths.append(str(file_path))\n                st.success(f\"ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å®Œäº†: {uploaded_file.name}\")\n            \n            # ãƒ‡ãƒ¼ã‚¿ã‚’æ›´æ–°\n            product = data_store.get_product(product_id)\n            if not product:\n                product = {}\n            product['tone_manner_images'] = image_paths\n            data_store.update_product(product_id, product)\n    \n    # å‚è€ƒç”»åƒåˆ†æãƒœã‚¿ãƒ³\n    if st.button('å‚è€ƒç”»åƒã‹ã‚‰æ§‹æˆã‚’åˆ†æ'):\n        product = data_store.get_product(product_id)\n        if product and 'reference_lp_images' in product:\n            settings_manager = SettingsManager()\n            settings = settings_manager.get_settings()\n            ai_provider = AIProvider(settings)\n            prompt_manager = PromptManager()\n            image_analyzer = ImageAnalyzer(ai_provider, prompt_manager)\n            analyze_reference_images(image_analyzer, product['reference_lp_images'], product_id, data_store)\n        else:\n            st.warning(\"å‚è€ƒLPç”»åƒãŒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã•ã‚Œã¦ã„ã¾ã›ã‚“\")\n\ndef analyze_reference_images(image_analyzer, image_paths, product_id, data_store):\n    '''å‚è€ƒç”»åƒã‹ã‚‰æ§‹æˆã‚’åˆ†æ'''\n    with st.spinner('å‚è€ƒç”»åƒã‚’åˆ†æä¸­...'):\n        try:\n            analysis_results = []\n            for image_path in image_paths:\n                if os.path.exists(image_path):\n                    result = image_analyzer.analyze_image(image_path)\n                    analysis_results.append(result)\n            \n            if analysis_results:\n                # åˆ†æçµæœã‚’çµ±åˆã—ã¦æ§‹æˆæƒ…å ±ã‚’ç”Ÿæˆ\n                structure_data = {\n                    'analysis_results': analysis_results,\n                    'analyzed_at': st.session_state.get('timestamp', ''),\n                    'image_count': len(analysis_results)\n                }\n                \n                # ãƒ‡ãƒ¼ã‚¿ã‚’æ›´æ–°\n                product = data_store.get_product(product_id)\n                if not product:\n                    product = {}\n                product['structure'] = structure_data\n                data_store.update_product(product_id, product)\n                \n                st.success(f\"{len(analysis_results)}ä»¶ã®ç”»åƒã‚’åˆ†æã—ã¾ã—ãŸ\")\n            else:\n                st.error(\"ç”»åƒã®åˆ†æã«å¤±æ•—ã—ã¾ã—ãŸ\")\n                \n        except Exception as e:\n            st.error(f\"åˆ†æã‚¨ãƒ©ãƒ¼: {e}\")\n\nrender_input_page()\n```\n\n===FILE: pages/03_model.py===\n```python\nimport streamlit as st\nimport base64\nfrom modules.model_generator import ModelGenerator\nfrom modules.ai_provider import AIProvider\nfrom modules.prompt_manager import PromptManager\nfrom modules.settings_manager import SettingsManager\n\n# ãƒšãƒ¼ã‚¸è¨­å®šï¼ˆã‚µã‚¤ãƒ‰ãƒãƒ¼ã§ã®è¡¨ç¤ºåã‚’æ—¥æœ¬èªã«ï¼‰\nst.set_page_config(page_title=\"ãƒ¢ãƒ‡ãƒ«è¨­å®š\")\n\ndef render_model_page():\n    st.title('ğŸ‘¤ ãƒ¢ãƒ‡ãƒ«è¨­å®š')\n    \n    # åˆæœŸåŒ–\n    settings_manager = SettingsManager()\n    settings = settings_manager.get_settings()\n    ai_provider = AIProvider(settings)\n    prompt_manager = PromptManager()\n    model_generator = ModelGenerator(ai_provider, prompt_manager)\n    \n    # ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹åˆæœŸåŒ–\n    if 'model_images' not in st.session_state:\n        st.session_state.model_images = [None] * 5\n    if 'model_prompts' not in st.session_state:\n        st.session_state.model_prompts = [None] * 5\n    \n    # ãƒ¢ãƒ‡ãƒ«æ•°é¸æŠ\n    num_models = st.slider('ãƒ¢ãƒ‡ãƒ«äººæ•°', 1, 5, 3)\n    \n    st.markdown(\"---\")\n    \n    # å„ãƒ¢ãƒ‡ãƒ«ã®è¨­å®š\n    tabs = st.tabs([f\"ãƒ¢ãƒ‡ãƒ«{i+1}\" for i in range(num_models)])\n    \n    options = model_generator.get_attribute_options()\n    \n    for i, tab in enumerate(tabs):\n        with tab:\n            render_model_config(i, options, model_generator)\n    \n    st.markdown(\"---\")\n    \n    # ä¸€æ‹¬ç”Ÿæˆãƒœã‚¿ãƒ³\n    if st.button('ğŸ¨ é¸æŠä¸­ã®ãƒ¢ãƒ‡ãƒ«ã‚’å…¨ã¦ç”Ÿæˆ', type='primary', key='generate_all_btn'):\n        generate_all_models(model_generator, num_models)\n    \n    # ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç¢ºèªã‚»ã‚¯ã‚·ãƒ§ãƒ³\n    with st.expander(\"ğŸ” ç”Ÿæˆãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç¢ºèªï¼ˆAIãŒæœ€é©åŒ–ï¼‰\", expanded=False):\n        for i in range(num_models):\n            if st.session_state.model_prompts[i]:\n                st.markdown(f\"**ãƒ¢ãƒ‡ãƒ«{i+1}:**\")\n                st.code(st.session_state.model_prompts[i], language=None)\n                st.markdown(\"---\")\n\ndef render_model_config(index: int, options: dict, model_generator):\n    \"\"\"å„ãƒ¢ãƒ‡ãƒ«ã®è¨­å®šUI\"\"\"\n    \n    col1, col2 = st.columns([2, 1])\n    \n    with col1:\n        st.subheader(f\"ãƒ¢ãƒ‡ãƒ«{index+1} å±æ€§è¨­å®š\")\n        \n        c1, c2, c3 = st.columns(3)\n        \n        with c1:\n            age = st.selectbox('å¹´é½¢', options.get('age', []), key=f'model_age_{index}')\n            ethnicity = st.selectbox('äººç¨®', options.get('ethnicity', []), key=f'model_eth_{index}')\n        \n        with c2:\n            gender = st.selectbox('æ€§åˆ¥', options.get('gender', []), key=f'model_gender_{index}')\n            atmosphere = st.selectbox('é›°å›²æ°—', options.get('atmosphere', []), key=f'model_atm_{index}')\n        \n        with c3:\n            clothing = st.selectbox('æœè£…', options.get('clothing', []), key=f'model_cloth_{index}')\n        \n        # ã‚«ã‚¹ã‚¿ãƒ æŒ‡ç¤º\n        custom_prompt = st.text_area(\n            'ğŸ“ è¿½åŠ æŒ‡ç¤ºãƒ»å‚™è€ƒï¼ˆAIãŒãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã«åæ˜ ï¼‰',\n            placeholder='ä¾‹: ç¬‘é¡”ã§è¦ªã—ã¿ã‚„ã™ã„ã€çœ¼é¡ã‚’ã‹ã‘ã¦ã„ã‚‹ã€çŸ­é«ªã€ç™½ã„èƒŒæ™¯',\n            key=f'model_custom_{index}',\n            height=100\n        )\n        \n        # ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰\n        uploaded_file = st.file_uploader(\n            'æ—¢å­˜ç”»åƒã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰',\n            type=['png', 'jpg', 'jpeg'],\n            key=f'model_upload_{index}'\n        )\n        \n        if uploaded_file:\n            image_bytes = uploaded_file.read()\n            st.session_state.model_images[index] = base64.b64encode(image_bytes).decode()\n            st.success('ç”»åƒã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¾ã—ãŸ')\n        \n        # ãƒœã‚¿ãƒ³\n        bc1, bc2, bc3 = st.columns(3)\n        with bc1:\n            if st.button('ğŸ¨ ç”Ÿæˆ', key=f'model_generate_btn_{index}', type='primary'):\n                generate_single_model(model_generator, index, {\n                    'age': age,\n                    'ethnicity': ethnicity,\n                    'gender': gender,\n                    'atmosphere': atmosphere,\n                    'clothing': clothing\n                }, custom_prompt)\n        with bc2:\n            if st.button('ğŸ“‹ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç¢ºèª', key=f'model_preview_btn_{index}'):\n                preview_prompt(model_generator, index, {\n                    'age': age,\n                    'ethnicity': ethnicity,\n                    'gender': gender,\n                    'atmosphere': atmosphere,\n                    'clothing': clothing\n                }, custom_prompt)\n        with bc3:\n            if st.button('ğŸ—‘ï¸ ã‚¯ãƒªã‚¢', key=f'model_clear_btn_{index}'):\n                st.session_state.model_images[index] = None\n                st.session_state.model_prompts[index] = None\n                st.rerun()\n    \n    with col2:\n        st.subheader(\"ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼\")\n        if st.session_state.model_images[index]:\n            try:\n                image_bytes = base64.b64decode(st.session_state.model_images[index])\n                st.image(image_bytes, use_container_width=True)\n            except:\n                st.info(\"ç”»åƒã‚’ç”Ÿæˆã—ã¦ãã ã•ã„\")\n        else:\n            st.info(\"ç”»åƒã‚’ç”Ÿæˆã—ã¦ãã ã•ã„\")\n        \n        if st.session_state.model_prompts[index]:\n            with st.expander(\"ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ\", expanded=False):\n                st.code(st.session_state.model_prompts[index], language=None)\n\ndef preview_prompt(model_generator, index: int, attributes: dict, custom_notes: str):\n    \"\"\"ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã®ã¿ã‚’ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ï¼ˆAIã§æœ€é©åŒ–ï¼‰\"\"\"\n    with st.spinner('AIãŒãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’æœ€é©åŒ–ä¸­...'):\n        try:\n            # ModelGeneratorã®generate_optimized_promptã‚’ä½¿ç”¨ï¼ˆå†…éƒ¨ã§PromptOptimizerã‚’å‘¼ã¶ï¼‰\n            prompt = model_generator.generate_optimized_prompt(attributes, custom_notes)\n            st.session_state.model_prompts[index] = prompt\n            st.success('ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç”Ÿæˆå®Œäº†')\n            st.rerun()\n        except Exception as e:\n            st.error(f'ã‚¨ãƒ©ãƒ¼: {str(e)}')\n\ndef generate_single_model(model_generator, index: int, attributes: dict, custom_notes: str):\n    \"\"\"å˜ä¸€ãƒ¢ãƒ‡ãƒ«ç”Ÿæˆï¼ˆAIã§ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆæœ€é©åŒ– + ç”»åƒç”Ÿæˆï¼‰\"\"\"\n    with st.spinner(f'ãƒ¢ãƒ‡ãƒ«{index+1}ã‚’ç”Ÿæˆä¸­... (AIãƒ—ãƒ­ãƒ³ãƒ—ãƒˆæœ€é©åŒ– + ç”»åƒç”Ÿæˆã§1-2åˆ†)'):\n        try:\n            # AIã§ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’æœ€é©åŒ–\n            prompt = model_generator.generate_optimized_prompt(attributes, custom_notes)\n            st.session_state.model_prompts[index] = prompt\n            \n            # ç”»åƒç”Ÿæˆ\n            from modules.image_generator import ImageGenerator\n            image_gen = ImageGenerator()\n            image_data = image_gen.generate(prompt)\n            \n            if image_data:\n                st.session_state.model_images[index] = image_data\n                st.success(f'ãƒ¢ãƒ‡ãƒ«{index+1}ã‚’ç”Ÿæˆã—ã¾ã—ãŸ')\n                st.rerun()\n            else:\n                st.error('ç”»åƒç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸ')\n        except Exception as e:\n            st.error(f'ã‚¨ãƒ©ãƒ¼: {str(e)}')\n\ndef generate_all_models(model_generator, num_models: int):\n    \"\"\"å…¨ãƒ¢ãƒ‡ãƒ«ä¸€æ‹¬ç”Ÿæˆ\"\"\"\n    progress = st.progress(0)\n    \n    for i in range(num_models):\n        progress.progress((i) / num_models, f'ãƒ¢ãƒ‡ãƒ«{i+1}ã‚’ç”Ÿæˆä¸­...')\n        \n        attributes = {\n            'age': st.session_state.get(f'model_age_{i}', '30ä»£'),\n            'ethnicity': st.session_state.get(f'model_eth_{i}', 'ã‚¢ã‚¸ã‚¢ç³»'),\n            'gender': st.session_state.get(f'model_gender_{i}', 'ç”·æ€§'),\n            'atmosphere': st.session_state.get(f'model_atm_{i}', 'ãƒŠãƒãƒ¥ãƒ©ãƒ«'),\n            'clothing': st.session_state.get(f'model_cloth_{i}', 'ãƒ“ã‚¸ãƒã‚¹')\n        }\n        custom_notes = st.session_state.get(f'model_custom_{i}', '')\n        \n        # æ—¢å­˜ç”»åƒãŒãªã‘ã‚Œã°ç”Ÿæˆ\n        if not st.session_state.model_images[i]:\n            try:\n                # AIã§ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆæœ€é©åŒ–\n                prompt = model_generator.generate_optimized_prompt(attributes, custom_notes)\n                st.session_state.model_prompts[i] = prompt\n                \n                # ç”»åƒç”Ÿæˆ\n                from modules.image_generator import ImageGenerator\n                image_gen = ImageGenerator()\n                image_data = image_gen.generate(prompt)\n                \n                if image_data:\n                    st.session_state.model_images[i] = image_data\n            except Exception as e:\n                st.error(f'ãƒ¢ãƒ‡ãƒ«{i+1}ç”Ÿæˆã‚¨ãƒ©ãƒ¼: {str(e)}')\n    \n    progress.progress(1.0, 'å®Œäº†!')\n    st.success('å…¨ãƒ¢ãƒ‡ãƒ«ã®ç”ŸæˆãŒå®Œäº†ã—ã¾ã—ãŸ')\n    st.rerun()\n\nrender_model_page()\n```\n\n===FILE: pages/04_structure.py===\n```python\nimport streamlit as st\nfrom modules.data_store import DataStore\n\n# ãƒšãƒ¼ã‚¸è¨­å®šï¼ˆã‚µã‚¤ãƒ‰ãƒãƒ¼ã§ã®è¡¨ç¤ºåã‚’æ—¥æœ¬èªã«ï¼‰\nst.set_page_config(page_title=\"å…¨ä½“æ§‹æˆ\")\n\ndef render_structure_page():\n    '''å…¨ä½“æ§‹æˆãƒšãƒ¼ã‚¸ã®ãƒ¡ã‚¤ãƒ³é–¢æ•°'''\n    st.title('ğŸ—ï¸ å…¨ä½“æ§‹æˆ')\n    \n    data_store = DataStore()\n    \n    # ç¾åœ¨ã®å•†å“IDã‚’å–å¾—\n    if 'current_product_id' not in st.session_state:\n        st.warning(\"å•†å“ãŒé¸æŠã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚å…¥åŠ›ç”»é¢ã‹ã‚‰å•†å“ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚\")\n        return\n    \n    product_id = st.session_state.current_product_id\n    product = data_store.get_product(product_id)\n    \n    if not product:\n        st.error(\"å•†å“ãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚\")\n        return\n    \n    # å‚è€ƒç”»åƒã‹ã‚‰æ§‹æˆã‚’åˆ†æãƒœã‚¿ãƒ³\n    col1, col2 = st.columns([2, 1])\n    with col1:\n        if st.button(\"ğŸ“Š å‚è€ƒç”»åƒã‹ã‚‰æ§‹æˆã‚’åˆ†æ\", type=\"primary\"):\n            with st.spinner(\"æ§‹æˆã‚’åˆ†æä¸­...\"):\n                # åˆ†æå‡¦ç†ã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ\n                st.success(\"æ§‹æˆã®åˆ†æãŒå®Œäº†ã—ã¾ã—ãŸã€‚\")\n                st.rerun()\n    \n    # æ§‹æˆãƒ‡ãƒ¼ã‚¿ã®å–å¾—\n    structure = product.get('structure', {})\n    pages = structure.get('pages', [])\n    \n    if not pages:\n        # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®æ§‹æˆã‚’ä½œæˆ\n        default_pages = [\n            {\n                'id': 'first_view',\n                'order': 1,\n                'type': 'first_view',\n                'title': 'ãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆãƒ“ãƒ¥ãƒ¼',\n                'summary': 'è¨ªå•è€…ã®æ³¨æ„ã‚’å¼•ãæœ€åˆã®ç”»é¢',\n                'elements': ['ãƒ¡ã‚¤ãƒ³ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«', 'ã‚­ãƒ£ãƒƒãƒã‚³ãƒ”ãƒ¼', 'CTAãƒœã‚¿ãƒ³']\n            },\n            {\n                'id': 'comparison',\n                'order': 2,\n                'type': 'comparison',\n                'title': 'æ¯”è¼ƒè¡¨',\n                'summary': 'å•†å“ãƒ»ã‚µãƒ¼ãƒ“ã‚¹ã®æ¯”è¼ƒæƒ…å ±',\n                'elements': ['æ¯”è¼ƒè¡¨', 'ç‰¹å¾´èª¬æ˜', 'ä¾¡æ ¼æ¯”è¼ƒ']\n            },\n            {\n                'id': 'features',\n                'order': 3,\n                'type': 'features',\n                'title': 'ç‰¹å¾´ãƒ»æ©Ÿèƒ½',\n                'summary': 'å•†å“ã®ç‰¹å¾´ã‚„æ©Ÿèƒ½ã®è©³ç´°èª¬æ˜',\n                'elements': ['æ©Ÿèƒ½ä¸€è¦§', 'è©³ç´°èª¬æ˜', 'ç”»åƒãƒ»å‹•ç”»']\n            }\n        ]\n        \n        # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆæ§‹æˆã‚’ä¿å­˜\n        if 'structure' not in product:\n            product['structure'] = {}\n        product['structure']['pages'] = default_pages\n        data_store.update_product(product_id, product)\n        pages = default_pages\n    \n    # ãƒšãƒ¼ã‚¸ãƒªã‚¹ãƒˆã®è¡¨ç¤º\n    render_page_list(structure, data_store, product_id)\n\ndef render_page_list(structure, data_store, product_id):\n    '''ãƒšãƒ¼ã‚¸ãƒªã‚¹ãƒˆè¡¨ç¤º'''\n    product = data_store.get_product(product_id)\n    pages = product.get('structure', {}).get('pages', [])\n    \n    if not pages:\n        st.info(\"æ§‹æˆãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚\")\n        return\n    \n    # ãƒšãƒ¼ã‚¸ã®é †åºã§ã‚½ãƒ¼ãƒˆ\n    pages_sorted = sorted(pages, key=lambda x: x.get('order', 0))\n    \n    st.subheader(\"ğŸ“„ ãƒšãƒ¼ã‚¸æ§‹æˆ\")\n    \n    for index, page in enumerate(pages_sorted):\n        render_page_item(page, index, data_store, product_id)\n\ndef render_page_item(page, index, data_store, product_id):\n    '''å˜ä¸€ãƒšãƒ¼ã‚¸é …ç›®'''\n    page_order = page.get('order', index + 1)\n    page_title = page.get('title', 'ã‚¿ã‚¤ãƒˆãƒ«æœªè¨­å®š')\n    page_summary = page.get('summary', 'æ¦‚è¦æœªè¨­å®š')\n    page_elements = page.get('elements', [])\n    \n    # expander ã§æŠ˜ã‚Šç•³ã¿è¡¨ç¤º\n    with st.expander(f\"P{page_order} - {page_title}\", expanded=False):\n        col1, col2 = st.columns([3, 1])\n        \n        with col1:\n            st.write(f\"**æ¦‚è¦:** {page_summary}\")\n            \n            if page_elements:\n                st.write(\"**æ§‹æˆè¦ç´ :**\")\n                for element in page_elements:\n                    st.write(f\"â€¢ {element}\")\n            else:\n                st.write(\"æ§‹æˆè¦ç´ ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚\")\n        \n        with col2:\n            # ç·¨é›†ãƒœã‚¿ãƒ³\n            edit_key = f\"edit_{page.get('id', index)}\"\n            if st.button(\"âœï¸ ç·¨é›†\", key=edit_key):\n                edit_page(page.get('id', index), data_store, product_id)\n            \n            # ä¸Šä¸‹ç§»å‹•ãƒœã‚¿ãƒ³\n            move_up_key = f\"move_up_{page.get('id', index)}\"\n            move_down_key = f\"move_down_{page.get('id', index)}\"\n            \n            if page_order > 1:\n                if st.button(\"â¬†ï¸\", key=move_up_key, help=\"ä¸Šã«ç§»å‹•\"):\n                    update_page_order_up(page, data_store, product_id)\n            \n            product = data_store.get_product(product_id)\n            pages = product.get('structure', {}).get('pages', [])\n            if page_order < len(pages):\n                if st.button(\"â¬‡ï¸\", key=move_down_key, help=\"ä¸‹ã«ç§»å‹•\"):\n                    update_page_order_down(page, data_store, product_id)\n\ndef update_page_order(pages, data_store, product_id):\n    '''ãƒšãƒ¼ã‚¸é †åºæ›´æ–°'''\n    product = data_store.get_product(product_id)\n    if product:\n        product['structure']['pages'] = pages\n        data_store.update_product(product_id, product)\n        st.rerun()\n\ndef update_page_order_up(page, data_store, product_id):\n    '''ãƒšãƒ¼ã‚¸ã‚’ä¸Šã«ç§»å‹•'''\n    product = data_store.get_product(product_id)\n    pages = product.get('structure', {}).get('pages', [])\n    \n    current_order = page.get('order', 0)\n    if current_order > 1:\n        # ç¾åœ¨ã®ãƒšãƒ¼ã‚¸ã®é †åºã‚’ä¸Šã’ã‚‹\n        for p in pages:\n            if p.get('id') == page.get('id'):\n                p['order'] = current_order - 1\n            elif p.get('order') == current_order - 1:\n                p['order'] = current_order\n        \n        product['structure']['pages'] = pages\n        data_store.update_product(product_id, product)\n        st.rerun()\n\ndef update_page_order_down(page, data_store, product_id):\n    '''ãƒšãƒ¼ã‚¸ã‚’ä¸‹ã«ç§»å‹•'''\n    product = data_store.get_product(product_id)\n    pages = product.get('structure', {}).get('pages', [])\n    \n    current_order = page.get('order', 0)\n    max_order = len(pages)\n    \n    if current_order < max_order:\n        # ç¾åœ¨ã®ãƒšãƒ¼ã‚¸ã®é †åºã‚’ä¸‹ã’ã‚‹\n        for p in pages:\n            if p.get('id') == page.get('id'):\n                p['order'] = current_order + 1\n            elif p.get('order') == current_order + 1:\n                p['order'] = current_order\n        \n        product['structure']['pages'] = pages\n        data_store.update_product(product_id, product)\n        st.rerun()\n\ndef edit_page(page_id, data_store, product_id):\n    '''ãƒšãƒ¼ã‚¸ç·¨é›†'''\n    product = data_store.get_product(product_id)\n    pages = product.get('structure', {}).get('pages', [])\n    \n    # ç·¨é›†å¯¾è±¡ã®ãƒšãƒ¼ã‚¸ã‚’å–å¾—\n    target_page = None\n    for page in pages:\n        if page.get('id') == page_id:\n            target_page = page\n            break\n    \n    if not target_page:\n        st.error(\"ç·¨é›†å¯¾è±¡ã®ãƒšãƒ¼ã‚¸ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚\")\n        return\n    \n    # ç·¨é›†ãƒ•ã‚©ãƒ¼ãƒ \n    st.subheader(f\"âœï¸ ãƒšãƒ¼ã‚¸ç·¨é›†: {target_page.get('title', '')}\")\n    \n    with st.form(f\"edit_form_{page_id}\"):\n        new_title = st.text_input(\"ã‚¿ã‚¤ãƒˆãƒ«\", value=target_page.get('title', ''))\n        new_summary = st.text_area(\"æ¦‚è¦\", value=target_page.get('summary', ''))\n        \n        # æ§‹æˆè¦ç´ ã®ç·¨é›†\n        elements = target_page.get('elements', [])\n        elements_text = '\\n'.join(elements)\n        new_elements_text = st.text_area",
    "timestamp": "2026-01-04T12:58:49.999932"
  },
  {
    "role": "user",
    "content": "ã‚µã‚¤ãƒ‰ãƒãƒ¼ã‚’æ—¥æœ¬èªã«ã—ãŸã„",
    "images": [],
    "timestamp": "2026-01-04T13:17:59.863766"
  },
  {
    "role": "assistant",
    "content": "APIã‚¨ãƒ©ãƒ¼: HTTPSConnectionPool(host='api.anthropic.com', port=443): Read timed out. (read timeout=60)",
    "timestamp": "2026-01-04T13:18:59.960390"
  },
  {
    "role": "user",
    "content": "ã‚µã‚¤ãƒ‰ãƒãƒ¼ã‚’æ—¥æœ¬èªã«ã—ãŸã„",
    "images": [],
    "timestamp": "2026-01-04T13:23:19.208181"
  },
  {
    "role": "assistant",
    "content": "===BASH===\ncat pages/06_output.py\n===END===\n\n===BASH===\ncat pages/07_prompt.py\n===END===\n\n===BASH===\ncat pages/08_settings.py\n===END===\n\n===BASH===\ncat pages/09_ai_chat.py\n===END===\n\n===FILE: pages/06_output.py===\n```python\nimport streamlit as st\nfrom modules.data_store import DataStore\nfrom modules.output_generator import OutputGenerator\nfrom modules.ai_provider import AIProvider\nfrom modules.prompt_manager import PromptManager\nfrom modules.settings_manager import SettingsManager\nimport zipfile\nimport io\nfrom pathlib import Path\nimport json\n\n# ãƒšãƒ¼ã‚¸è¨­å®šï¼ˆã‚µã‚¤ãƒ‰ãƒãƒ¼ã§ã®è¡¨ç¤ºåã‚’æ—¥æœ¬èªã«ï¼‰\nst.set_page_config(page_title=\"å‡ºåŠ›ãƒ»ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰\")\n\ndef render_output_page():\n    '''å‡ºåŠ›ãƒ»ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãƒšãƒ¼ã‚¸ã®ãƒ¡ã‚¤ãƒ³é–¢æ•°'''\n    st.title('ğŸ“¤ å‡ºåŠ›ãƒ»ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰')\n    \n    data_store = DataStore()\n    \n    # ç¾åœ¨ã®å•†å“IDã‚’å–å¾—\n    if 'current_product_id' not in st.session_state:\n        st.warning(\"å•†å“ãŒé¸æŠã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚\")\n        return\n    \n    product_id = st.session_state.current_product_id\n    product = data_store.get_product(product_id)\n    \n    if not product:\n        st.error(\"å•†å“ãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚\")\n        return\n    \n    # å‡ºåŠ›å½¢å¼é¸æŠ\n    st.subheader(\"ğŸ“‹ å‡ºåŠ›å½¢å¼ã‚’é¸æŠ\")\n    \n    col1, col2, col3 = st.columns(3)\n    \n    with col1:\n        output_html = st.checkbox(\"HTML ãƒ•ã‚¡ã‚¤ãƒ«\", value=True)\n        output_figma = st.checkbox(\"Figmaç”¨ãƒ‡ãƒ¼ã‚¿\")\n    \n    with col2:\n        output_pdf = st.checkbox(\"PDF ãƒ¬ãƒãƒ¼ãƒˆ\")\n        output_images = st.checkbox(\"ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ä¸€å¼\", value=True)\n    \n    with col3:\n        output_json = st.checkbox(\"JSON ãƒ‡ãƒ¼ã‚¿\")\n        output_prompt = st.checkbox(\"ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆé›†\")\n    \n    # ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼\n    with st.expander(\"ğŸ“± HTMLãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼\", expanded=False):\n        render_html_preview(product)\n    \n    # ä¸€æ‹¬å‡ºåŠ›ãƒœã‚¿ãƒ³\n    if st.button(\"ğŸš€ é¸æŠã—ãŸå½¢å¼ã§ä¸€æ‹¬å‡ºåŠ›\", type=\"primary\"):\n        generate_outputs(product, product_id, {\n            'html': output_html,\n            'figma': output_figma,\n            'pdf': output_pdf,\n            'images': output_images,\n            'json': output_json,\n            'prompt': output_prompt\n        })\n    \n    # å€‹åˆ¥å‡ºåŠ›ã‚»ã‚¯ã‚·ãƒ§ãƒ³\n    st.markdown(\"---\")\n    st.subheader(\"ğŸ“ å€‹åˆ¥å‡ºåŠ›\")\n    \n    col_out1, col_out2, col_out3 = st.columns(3)\n    \n    with col_out1:\n        if st.button(\"ğŸ“„ HTMLå‡ºåŠ›\"):\n            generate_html_output(product, product_id)\n        if st.button(\"ğŸ–¼ï¸ ç”»åƒå‡ºåŠ›\"):\n            generate_images_output(product, product_id)\n    \n    with col_out2:\n        if st.button(\"ğŸ“‹ PDFå‡ºåŠ›\"):\n            generate_pdf_output(product, product_id)\n        if st.button(\"ğŸ¨ Figmaå‡ºåŠ›\"):\n            generate_figma_output(product, product_id)\n    \n    with col_out3:\n        if st.button(\"ğŸ“Š JSONå‡ºåŠ›\"):\n            generate_json_output(product, product_id)\n        if st.button(\"ğŸ“ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆå‡ºåŠ›\"):\n            generate_prompt_output(product, product_id)\n\ndef render_html_preview(product):\n    '''HTMLãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼è¡¨ç¤º'''\n    try:\n        settings_manager = SettingsManager()\n        settings = settings_manager.get_settings()\n        ai_provider = AIProvider(settings)\n        prompt_manager = PromptManager()\n        output_generator = OutputGenerator(ai_provider, prompt_manager)\n        \n        html_content = output_generator.generate_html(product)\n        \n        # HTMLã‚’iframeã§è¡¨ç¤º\n        st.components.v1.html(html_content, height=600, scrolling=True)\n        \n    except Exception as e:\n        st.error(f\"ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ç”Ÿæˆã‚¨ãƒ©ãƒ¼: {e}\")\n\ndef generate_outputs(product, product_id, output_options):\n    '''é¸æŠã•ã‚ŒãŸå½¢å¼ã§ä¸€æ‹¬å‡ºåŠ›'''\n    with st.spinner(\"å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”Ÿæˆä¸­...\"):\n        try:\n            settings_manager = SettingsManager()\n            settings = settings_manager.get_settings()\n            ai_provider = AIProvider(settings)\n            prompt_manager = PromptManager()\n            output_generator = OutputGenerator(ai_provider, prompt_manager)\n            \n            # ZIPãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ\n            zip_buffer = io.BytesIO()\n            with zipfile.ZipFile(zip_buffer, 'w', zipfile.ZIP_DEFLATED) as zip_file:\n                \n                if output_options['html']:\n                    html_content = output_generator.generate_html(product)\n                    zip_file.writestr(f\"{product.get('name', 'product')}.html\", html_content)\n                \n                if output_options['json']:\n                    json_content = json.dumps(product, ensure_ascii=False, indent=2)\n                    zip_file.writestr(f\"{product.get('name', 'product')}.json\", json_content)\n                \n                if output_options['prompt']:\n                    prompts = output_generator.generate_prompt_collection(product)\n                    zip_file.writestr(\"prompts.txt\", prompts)\n                \n                if output_options['pdf']:\n                    # PDFã¯å®Ÿè£…ãŒè¤‡é›‘ãªã®ã§ã‚¹ã‚­ãƒƒãƒ—\n                    zip_file.writestr(\"pdf_placeholder.txt\", \"PDFæ©Ÿèƒ½ã¯ä»Šå¾Œå®Ÿè£…äºˆå®šã§ã™\")\n                \n                if output_options['figma']:\n                    figma_data = output_generator.generate_figma_data(product)\n                    zip_file.writestr(\"figma_data.json\", json.dumps(figma_data, ensure_ascii=False, indent=2))\n                \n                if output_options['images']:\n                    # ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ã‚’è¿½åŠ \n                    add_images_to_zip(zip_file, product, product_id)\n            \n            zip_buffer.seek(0)\n            \n            st.download_button(\n                label=\"ğŸ“¥ ZIPãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰\",\n                data=zip_buffer.getvalue(),\n                file_name=f\"{product.get('name', 'product')}_output.zip\",\n                mime=\"application/zip\"\n            )\n            \n            st.success(\"å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«ãŒç”Ÿæˆã•ã‚Œã¾ã—ãŸï¼\")\n            \n        except Exception as e:\n            st.error(f\"å‡ºåŠ›ç”Ÿæˆã‚¨ãƒ©ãƒ¼: {e}\")\n\ndef generate_html_output(product, product_id):\n    '''HTMLå˜ä½“å‡ºåŠ›'''\n    try:\n        settings_manager = SettingsManager()\n        settings = settings_manager.get_settings()\n        ai_provider = AIProvider(settings)\n        prompt_manager = PromptManager()\n        output_generator = OutputGenerator(ai_provider, prompt_manager)\n        \n        html_content = output_generator.generate_html(product)\n        \n        st.download_button(\n            label=\"ğŸ“„ HTMLãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰\",\n            data=html_content,\n            file_name=f\"{product.get('name', 'product')}.html\",\n            mime=\"text/html\"\n        )\n        \n    except Exception as e:\n        st.error(f\"HTMLå‡ºåŠ›ã‚¨ãƒ©ãƒ¼: {e}\")\n\ndef generate_pdf_output(product, product_id):\n    '''PDFå˜ä½“å‡ºåŠ›'''\n    st.info(\"PDFå‡ºåŠ›æ©Ÿèƒ½ã¯ä»Šå¾Œå®Ÿè£…äºˆå®šã§ã™\")\n\ndef generate_figma_output(product, product_id):\n    '''Figmaå˜ä½“å‡ºåŠ›'''\n    try:\n        settings_manager = SettingsManager()\n        settings = settings_manager.get_settings()\n        ai_provider = AIProvider(settings)\n        prompt_manager = PromptManager()\n        output_generator = OutputGenerator(ai_provider, prompt_manager)\n        \n        figma_data = output_generator.generate_figma_data(product)\n        \n        st.download_button(\n            label=\"ğŸ¨ Figmaãƒ‡ãƒ¼ã‚¿ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰\",\n            data=json.dumps(figma_data, ensure_ascii=False, indent=2),\n            file_name=f\"{product.get('name', 'product')}_figma.json\",\n            mime=\"application/json\"\n        )\n        \n    except Exception as e:\n        st.error(f\"Figmaå‡ºåŠ›ã‚¨ãƒ©ãƒ¼: {e}\")\n\ndef generate_json_output(product, product_id):\n    '''JSONå˜ä½“å‡ºåŠ›'''\n    try:\n        json_content = json.dumps(product, ensure_ascii=False, indent=2)\n        \n        st.download_button(\n            label=\"ğŸ“Š JSONãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰\",\n            data=json_content,\n            file_name=f\"{product.get('name', 'product')}.json\",\n            mime=\"application/json\"\n        )\n        \n    except Exception as e:\n        st.error(f\"JSONå‡ºåŠ›ã‚¨ãƒ©ãƒ¼: {e}\")\n\ndef generate_images_output(product, product_id):\n    '''ç”»åƒå˜ä½“å‡ºåŠ›'''\n    try:\n        # ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ã‚’ZIPã«ã¾ã¨ã‚ã‚‹\n        zip_buffer = io.BytesIO()\n        with zipfile.ZipFile(zip_buffer, 'w', zipfile.ZIP_DEFLATED) as zip_file:\n            add_images_to_zip(zip_file, product, product_id)\n        \n        zip_buffer.seek(0)\n        \n        st.download_button(\n            label=\"ğŸ–¼ï¸ ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ä¸€å¼ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰\",\n            data=zip_buffer.getvalue(),\n            file_name=f\"{product.get('name', 'product')}_images.zip\",\n            mime=\"application/zip\"\n        )\n        \n    except Exception as e:\n        st.error(f\"ç”»åƒå‡ºåŠ›ã‚¨ãƒ©ãƒ¼: {e}\")\n\ndef generate_prompt_output(product, product_id):\n    '''ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆå˜ä½“å‡ºåŠ›'''\n    try:\n        settings_manager = SettingsManager()\n        settings = settings_manager.get_settings()\n        ai_provider = AIProvider(settings)\n        prompt_manager = PromptManager()\n        output_generator = OutputGenerator(ai_provider, prompt_manager)\n        \n        prompts = output_generator.generate_prompt_collection(product)\n        \n        st.download_button(\n            label=\"ğŸ“ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆé›†ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰\",\n            data=prompts,\n            file_name=f\"{product.get('name', 'product')}_prompts.txt\",\n            mime=\"text/plain\"\n        )\n        \n    except Exception as e:\n        st.error(f\"ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆå‡ºåŠ›ã‚¨ãƒ©ãƒ¼: {e}\")\n\ndef add_images_to_zip(zip_file, product, product_id):\n    '''ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ã‚’ZIPã«è¿½åŠ '''\n    try:\n        upload_dir = Path(f\"data/uploads/{product_id}\")\n        if upload_dir.exists():\n            for image_path in upload_dir.rglob(\"*.png\"):\n                if image_path.is_file():\n                    zip_file.write(image_path, f\"images/{image_path.name}\")\n            for image_path in upload_dir.rglob(\"*.jpg\"):\n                if image_path.is_file():\n                    zip_file.write(image_path, f\"images/{image_path.name}\")\n            for image_path in upload_dir.rglob(\"*.jpeg\"):\n                if image_path.is_file():\n                    zip_file.write(image_path, f\"images/{image_path.name}\")\n    except Exception as e:\n        print(f\"ç”»åƒè¿½åŠ ã‚¨ãƒ©ãƒ¼: {e}\")\n\nrender_output_page()\n```\n\n===FILE: pages/07_prompt.py===\n```python\nimport streamlit as st\nfrom modules.prompt_manager import PromptManager\nfrom modules.settings_manager import SettingsManager\nfrom modules.ai_provider import AIProvider\nfrom modules.data_store import DataStore\nimport json\n\n# ãƒšãƒ¼ã‚¸è¨­å®šï¼ˆã‚µã‚¤ãƒ‰ãƒãƒ¼ã§ã®è¡¨ç¤ºåã‚’æ—¥æœ¬èªã«ï¼‰\nst.set_page_config(page_title=\"ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç®¡ç†\")\n\ndef render_prompt_page():\n    '''ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç®¡ç†ãƒšãƒ¼ã‚¸ã®ãƒ¡ã‚¤ãƒ³é–¢æ•°'''\n    st.title('ğŸ“ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç®¡ç†')\n    \n    # ã‚¿ãƒ–åˆ†ã‘\n    tab1, tab2, tab3, tab4 = st.tabs([\"ğŸ”§ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆè¨­å®š\", \"ğŸ¨ ç”Ÿæˆãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ\", \"ğŸ“Š å±¥æ­´\", \"âš™ï¸ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ\"])\n    \n    with tab1:\n        render_prompt_settings()\n    \n    with tab2:\n        render_generated_prompts()\n    \n    with tab3:\n        render_prompt_history()\n    \n    with tab4:\n        render_prompt_templates()\n\ndef render_prompt_settings():\n    '''ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆè¨­å®šã‚¿ãƒ–'''\n    st.subheader(\"ğŸ”§ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆè¨­å®š\")\n    \n    prompt_manager = PromptManager()\n    \n    # ã‚«ãƒ†ã‚´ãƒªé¸æŠ\n    categories = [\"ç”»åƒç”Ÿæˆ\", \"ãƒ†ã‚­ã‚¹ãƒˆç”Ÿæˆ\", \"åˆ†æ\", \"æ§‹æˆ\", \"ãã®ä»–\"]\n    selected_category = st.selectbox(\"ã‚«ãƒ†ã‚´ãƒªã‚’é¸æŠ\", categories)\n    \n    # ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆç·¨é›†\n    st.write(\"**ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆç·¨é›†**\")\n    \n    if selected_category == \"ç”»åƒç”Ÿæˆ\":\n        render_image_prompt_settings(prompt_manager)\n    elif selected_category == \"ãƒ†ã‚­ã‚¹ãƒˆç”Ÿæˆ\":\n        render_text_prompt_settings(prompt_manager)\n    elif selected_category == \"åˆ†æ\":\n        render_analysis_prompt_settings(prompt_manager)\n    elif selected_category == \"æ§‹æˆ\":\n        render_structure_prompt_settings(prompt_manager)\n    else:\n        render_other_prompt_settings(prompt_manager)\n\ndef render_image_prompt_settings(prompt_manager):\n    '''ç”»åƒç”Ÿæˆãƒ—ãƒ­ãƒ³ãƒ—ãƒˆè¨­å®š'''\n    st.write(\"**ç”»åƒç”Ÿæˆãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ**\")\n    \n    # åŸºæœ¬ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ\n    base_template = st.text_area(\n        \"åŸºæœ¬ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ\",\n        value=\"A professional photo of {subject}, {style}, {lighting}, {background}\",\n        height=100\n    )\n    \n    # ã‚¹ã‚¿ã‚¤ãƒ«è¨­å®š\n    col1, col2 = st.columns(2)\n    \n    with col1:\n        st.write(\"**ã‚¹ã‚¿ã‚¤ãƒ«è¨­å®š**\")\n        styles = st.text_area(\n            \"åˆ©ç”¨å¯èƒ½ã‚¹ã‚¿ã‚¤ãƒ«ï¼ˆ1è¡Œ1ã¤ï¼‰\",\n            value=\"professional\\ncasual\\nminimal\\ncolorful\\nmodern\\nclassic\",\n            height=120\n        )\n    \n    with col2:\n        st.write(\"**ãƒ©ã‚¤ãƒ†ã‚£ãƒ³ã‚°è¨­å®š**\")\n        lighting = st.text_area(\n            \"åˆ©ç”¨å¯èƒ½ãƒ©ã‚¤ãƒ†ã‚£ãƒ³ã‚°ï¼ˆ1è¡Œ1ã¤ï¼‰\",\n            value=\"natural light\\nsoft lighting\\nstudio lighting\\nwarm lighting\\ncool lighting\",\n            height=120\n        )\n    \n    # ä¿å­˜ãƒœã‚¿ãƒ³\n    if st.button(\"ğŸ’¾ ç”»åƒãƒ—ãƒ­ãƒ³ãƒ—ãƒˆè¨­å®šã‚’ä¿å­˜\", type=\"primary\"):\n        settings = {\n            'base_template': base_template,\n            'styles': styles.",
    "timestamp": "2026-01-04T13:28:22.096862"
  },
  {
    "role": "user",
    "content": "ã‚µã‚¤ãƒ‰ãƒãƒ¼ã‚’æ—¥æœ¬èªè¡¨è¨˜ã«ã—ã¦",
    "images": [],
    "timestamp": "2026-01-04T13:38:18.224069"
  },
  {
    "role": "assistant",
    "content": "APIã‚¨ãƒ©ãƒ¼: HTTPSConnectionPool(host='api.anthropic.com', port=443): Read timed out. (read timeout=90)",
    "timestamp": "2026-01-04T13:45:54.412072"
  }
]